<div class="admin-container">
  <h1 class="admin-header"><%= t('rails_image_post_solution.admin.show.title') %></h1>

  <div class="report-detail">
    <!-- Image Display -->
    <div class="detail-section">
      <h3><%= t('rails_image_post_solution.admin.show.reported_image') %></h3>
      <% if @attachment.present? %>
        <div class="reported-image-container">
          <%= image_tag @attachment.blob, class: "reported-image-large", style: "max-width: 800px; max-height: 600px;" %>
        </div>
      <% else %>
        <p class="text-muted"><%= t('rails_image_post_solution.admin.show.image_deleted') %></p>
      <% end %>
    </div>

    <!-- Report Information -->
    <div class="detail-section">
      <h3><%= t('rails_image_post_solution.admin.show.report_info') %></h3>
      <table class="detail-table">
        <tr>
          <th><%= t('rails_image_post_solution.admin.show.status') %></th>
          <td>
            <span class="status-badge status-<%= @report.status %>">
              <%= t("rails_image_post_solution.image_report.statuses.#{@report.status}") %>
            </span>
          </td>
        </tr>
        <tr>
          <th><%= t('rails_image_post_solution.admin.show.reporter') %></th>
          <td><%= link_to @report.user.display_name, user_path(@report.user), class: "user-link" %></td>
        </tr>
        <tr>
          <th><%= t('rails_image_post_solution.admin.show.reason') %></th>
          <td><%= simple_format(@report.reason) || t('rails_image_post_solution.admin.show.no_reason') %></td>
        </tr>
        <tr>
          <th><%= t('rails_image_post_solution.admin.show.reported_at') %></th>
          <td><%= l(@report.created_at, format: :long) %></td>
        </tr>
        <% if @report.reviewed_by %>
          <tr>
            <th><%= t('rails_image_post_solution.admin.show.reviewer') %></th>
            <td><%= @report.reviewed_by.display_name %></td>
          </tr>
          <tr>
            <th><%= t('rails_image_post_solution.admin.show.reviewed_at') %></th>
            <td><%= l(@report.reviewed_at, format: :long) %></td>
          </tr>
        <% end %>
      </table>
    </div>

    <!-- Image Poster Information -->
    <% if @reported_user %>
      <div class="detail-section">
        <h3><%= t('rails_image_post_solution.admin.show.image_poster') %></h3>
        <table class="detail-table">
          <tr>
            <th><%= t('rails_image_post_solution.admin.show.username') %></th>
            <td><%= link_to @reported_user.display_name, user_path(@reported_user), class: "user-link" %></td>
          </tr>
          <tr>
            <th><%= t('rails_image_post_solution.admin.show.user_status') %></th>
            <td>
              <% if @reported_user.banned? %>
                <span class="user-status-badge banned"><%= t('rails_image_post_solution.admin.show.banned') %></span>
              <% elsif @reported_user.suspended? %>
                <span class="user-status-badge suspended"><%= t('rails_image_post_solution.admin.show.suspended') %></span>
              <% else %>
                <span class="user-status-badge active"><%= t('rails_image_post_solution.admin.show.active') %></span>
              <% end %>
            </td>
          </tr>
        </table>
      </div>
    <% end %>

    <!-- Other Reports for Same Image -->
    <div class="detail-section">
      <h3><%= t('rails_image_post_solution.admin.show.all_reports_title', count: @all_reports.count) %></h3>
      <% if @all_reports.count > 1 %>
        <table class="admin-table">
          <thead>
            <tr>
              <th><%= t('rails_image_post_solution.admin.index.table.reporter') %></th>
              <th><%= t('rails_image_post_solution.admin.index.table.reason') %></th>
              <th><%= t('rails_image_post_solution.admin.index.table.status') %></th>
              <th><%= t('rails_image_post_solution.admin.index.table.reported_at') %></th>
            </tr>
          </thead>
          <tbody>
            <% @all_reports.each do |r| %>
              <tr class="<%= 'current-report' if r.id == @report.id %>">
                <td>
                  <%= link_to r.user.display_name, user_path(r.user), class: "user-link" %>
                  <% if r.id == @report.id %>
                    <span class="badge-current"><%= t('rails_image_post_solution.admin.show.current') %></span>
                  <% end %>
                </td>
                <td><%= truncate(r.reason, length: 50) || t('rails_image_post_solution.admin.index.no_reason') %></td>
                <td>
                  <span class="status-badge status-<%= r.status %>">
                    <%= t("rails_image_post_solution.image_report.statuses.#{r.status}") %>
                  </span>
                </td>
                <td><%= l(r.created_at, format: :long) %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% else %>
        <p class="text-muted"><%= t('rails_image_post_solution.admin.show.single_report') %></p>
      <% end %>
    </div>

    <!-- Actions -->
    <div class="detail-actions">
      <% if @report.status == ImageReport::STATUSES[:pending] %>
        <%= button_to t('rails_image_post_solution.admin.show.confirm_button'), confirm_admin_image_report_path(@report), method: :patch, class: "btn btn-danger", data: { turbo_confirm: t('rails_image_post_solution.admin.show.confirm_action') } %>
        <%= button_to t('rails_image_post_solution.admin.show.dismiss_button'), dismiss_admin_image_report_path(@report), method: :patch, class: "btn btn-success", data: { turbo_confirm: t('rails_image_post_solution.admin.show.dismiss_action') } %>
      <% else %>
        <p class="text-muted"><%= t('rails_image_post_solution.admin.show.already_reviewed') %></p>
      <% end %>

      <% if @reported_user && @reported_user.active? %>
        <div class="user-actions">
          <h4><%= t('rails_image_post_solution.admin.show.user_actions') %></h4>
          <%= link_to t('rails_image_post_solution.admin.show.view_user_admin'), admin_user_path(@reported_user), class: "btn btn-secondary" %>
        </div>
      <% end %>
    </div>
  </div>

  <div class="admin-actions">
    <%= link_to t('rails_image_post_solution.admin.show.back_to_list'), admin_image_reports_path, class: "btn btn-default" %>
  </div>
</div>

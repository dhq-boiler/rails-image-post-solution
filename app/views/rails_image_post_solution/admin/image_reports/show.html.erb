<div class="admin-container">
  <h1 class="admin-header"><%= t('rails_image_post_solution.admin.show.title') %></h1>

  <div class="report-detail">
    <!-- Image Display -->
    <div class="detail-section">
      <h3><%= t('rails_image_post_solution.admin.show.reported_image') %></h3>
      <% if @attachment.present? %>
        <div class="reported-image-container">
          <%= image_tag main_app.rails_blob_path(@attachment, only_path: true), class: "reported-image-large", style: "max-width: 800px; max-height: 600px;" %>
        </div>
      <% else %>
        <p class="text-muted"><%= t('rails_image_post_solution.admin.show.image_deleted') %></p>
      <% end %>
    </div>

    <!-- Report Information -->
    <div class="detail-section">
      <h3><%= t('rails_image_post_solution.admin.show.report_info') %></h3>
      <table class="detail-table">
        <tr>
          <th><%= t('rails_image_post_solution.admin.show.status') %></th>
          <td>
            <span class="status-badge status-<%= @report.status %>">
              <%= t("rails_image_post_solution.image_report.statuses.#{@report.status}") %>
            </span>
          </td>
        </tr>
        <tr>
          <th><%= t('rails_image_post_solution.admin.show.reporter') %></th>
          <td>
            <% if @report.user %>
              <%= @report.user.try(:display_name) || @report.user.try(:name) || "Unknown" %>
            <% else %>
              <span class="text-muted"><%= t('rails_image_post_solution.admin.show.system_ai') %></span>
            <% end %>
          </td>
        </tr>
        <tr>
          <th><%= t('rails_image_post_solution.admin.show.reason') %></th>
          <td><%= simple_format(@report.reason) || t('rails_image_post_solution.admin.show.no_reason') %></td>
        </tr>
        <tr>
          <th><%= t('rails_image_post_solution.admin.show.reported_at') %></th>
          <td><%= l(@report.created_at, format: :long) %></td>
        </tr>
        <% if @report.reviewed_by %>
          <tr>
            <th><%= t('rails_image_post_solution.admin.show.reviewer') %></th>
            <td><%= @report.reviewed_by.try(:display_name) || @report.reviewed_by.try(:name) || "Unknown" %></td>
          </tr>
          <tr>
            <th><%= t('rails_image_post_solution.admin.show.reviewed_at') %></th>
            <td><%= l(@report.reviewed_at, format: :long) %></td>
          </tr>
        <% end %>
        <% if @report.ai_flagged %>
          <tr>
            <th><%= t('rails_image_post_solution.admin.show.ai_detection') %></th>
            <td>
              <span class="badge badge-warning"><%= t('rails_image_post_solution.admin.show.ai_detected') %></span>
              <% if @report.ai_confidence %>
                <%= t('rails_image_post_solution.admin.show.confidence') %>: <%= (@report.ai_confidence * 100).round(1) %>%
              <% end %>
            </td>
          </tr>
        <% end %>
      </table>
    </div>

    <!-- Image Poster Information -->
    <% if @reported_user %>
      <div class="detail-section">
        <h3><%= t('rails_image_post_solution.admin.show.image_poster') %></h3>
        <table class="detail-table">
          <tr>
            <th><%= t('rails_image_post_solution.admin.show.username') %></th>
            <td><%= @reported_user.try(:display_name) || @reported_user.try(:name) || "Unknown" %></td>
          </tr>
          <% if @reported_user.respond_to?(:banned?) %>
            <tr>
              <th><%= t('rails_image_post_solution.admin.show.user_status') %></th>
              <td>
                <% if @reported_user.banned? %>
                  <span class="user-status-badge banned"><%= t('rails_image_post_solution.admin.show.banned') %></span>
                <% elsif @reported_user.respond_to?(:suspended?) && @reported_user.suspended? %>
                  <span class="user-status-badge suspended"><%= t('rails_image_post_solution.admin.show.suspended') %></span>
                <% else %>
                  <span class="user-status-badge active"><%= t('rails_image_post_solution.admin.show.active') %></span>
                <% end %>
              </td>
            </tr>
          <% end %>
        </table>
      </div>
    <% end %>

    <!-- Other Reports for Same Image -->
    <div class="detail-section">
      <h3><%= t('rails_image_post_solution.admin.show.all_reports_title', count: @all_reports.count) %></h3>
      <% if @all_reports.count > 1 %>
        <table class="admin-table">
          <thead>
            <tr>
              <th><%= t('rails_image_post_solution.admin.index.table.reporter') %></th>
              <th><%= t('rails_image_post_solution.admin.index.table.reason') %></th>
              <th><%= t('rails_image_post_solution.admin.index.table.status') %></th>
              <th><%= t('rails_image_post_solution.admin.index.table.reported_at') %></th>
            </tr>
          </thead>
          <tbody>
            <% @all_reports.each do |r| %>
              <tr class="<%= 'current-report' if r.id == @report.id %>">
                <td>
                  <% if r.user %>
                    <%= r.user.try(:display_name) || r.user.try(:name) || "Unknown" %>
                  <% else %>
                    <span class="text-muted"><%= t('rails_image_post_solution.admin.index.system') %></span>
                  <% end %>
                  <% if r.id == @report.id %>
                    <span class="badge-current"><%= t('rails_image_post_solution.admin.show.current') %></span>
                  <% end %>
                </td>
                <td><%= truncate(r.reason, length: 50) || t('rails_image_post_solution.admin.index.no_reason') %></td>
                <td>
                  <span class="status-badge status-<%= r.status %>">
                    <%= t("rails_image_post_solution.image_report.statuses.#{r.status}") %>
                  </span>
                </td>
                <td><%= l(r.created_at, format: :long) %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% else %>
        <p class="text-muted"><%= t('rails_image_post_solution.admin.show.single_report') %></p>
      <% end %>
    </div>

    <!-- Actions -->
    <div class="detail-actions">
      <% if @report.status == RailsImagePostSolution::ImageReport::STATUSES[:pending] %>
        <%= button_to t('rails_image_post_solution.admin.show.confirm_button'), rails_image_post_solution.confirm_admin_image_report_path(id: @report.id), method: :patch, class: "btn btn-danger", data: { turbo_confirm: t('rails_image_post_solution.admin.show.confirm_action') } %>
        <%= button_to t('rails_image_post_solution.admin.show.dismiss_button'), rails_image_post_solution.dismiss_admin_image_report_path(id: @report.id), method: :patch, class: "btn btn-success", data: { turbo_confirm: t('rails_image_post_solution.admin.show.dismiss_action') } %>
      <% else %>
        <p class="text-muted"><%= t('rails_image_post_solution.admin.show.already_reviewed') %></p>
      <% end %>
    </div>
  </div>

  <div class="admin-actions">
    <%= link_to t('rails_image_post_solution.admin.show.back_to_list'), rails_image_post_solution.admin_image_reports_path, class: "btn btn-default" %>
  </div>
</div>
